<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Creator - Static View</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #f0f0f0;
        }

        .control-bar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .control-btn.save {
            background: #28a745;
        }

        .control-btn.save:hover {
            background: #1e7e34;
        }

        .map-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #e9ecef;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            overflow: hidden;
        }

        .circle-button {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #007bff;
            border: 3px solid white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.2s ease;
            user-select: none;
            z-index: 10;
        }

        .circle-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: #f8f9fa;
            color: #333;
        }

        .file-upload-section {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
            text-align: center;
        }

        .upload-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .upload-btn:hover {
            background: #1e7e34;
        }

        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .media-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            position: relative;
            transition: all 0.2s ease;
        }

        .media-item:hover {
            background: #e9ecef;
        }

        .media-preview {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .media-name {
            font-size: 12px;
            color: #666;
            word-break: break-word;
        }

        .remove-media {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .file-input {
            display: none;
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }

        /* Lightbox Carousel Styles */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            backdrop-filter: blur(5px);
        }

        .lightbox-content {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-media {
            max-width: 90vw;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .lightbox-document {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .lightbox-document-icon {
            font-size: 64px;
            margin-bottom: 20px;
            color: #666;
        }

        .lightbox-document-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            word-break: break-word;
        }

        .lightbox-download-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .lightbox-download-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            padding: 15px 20px;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }

        .lightbox-nav:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .lightbox-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .lightbox-nav.prev {
            left: 20px;
        }

        .lightbox-nav.next {
            right: 20px;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.2s ease;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .lightbox-info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .media-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            position: relative;
            transition: all 0.2s ease;
            cursor: pointer;
        }
    
        .info-banner {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1976d2;
            padding: 10px;
            margin: 10px;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
        }
        .map-container {
            height: calc(100vh - 42px) !important;
        }</style>
</head>
<body style="overflow: auto;"><div class="info-banner">üìã Static Map View - Generated on 8/8/2025, 10:02:09 PM (with embedded files)</div>
    

    <div class="map-container" id="mapContainer" style="background-image: url(&quot;data:image/svg+xml,<svg xmlns=\&quot;http://www.w3.org/2000/svg\&quot; viewBox=\&quot;0 0 800 600\&quot;><rect width=\&quot;800\&quot; height=\&quot;600\&quot; fill=\&quot;%23f8f9fa\&quot; stroke=\&quot;%23dee2e6\&quot; stroke-width=\&quot;2\&quot;/><rect x=\&quot;50\&quot; y=\&quot;50\&quot; width=\&quot;200\&quot; height=\&quot;150\&quot; fill=\&quot;none\&quot; stroke=\&quot;%23adb5bd\&quot; stroke-width=\&quot;1\&quot;/><text x=\&quot;150\&quot; y=\&quot;130\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;Arial\&quot; font-size=\&quot;14\&quot; fill=\&quot;%23495057\&quot;>Room 1</text><rect x=\&quot;300\&quot; y=\&quot;50\&quot; width=\&quot;150\&quot; height=\&quot;150\&quot; fill=\&quot;none\&quot; stroke=\&quot;%23adb5bd\&quot; stroke-width=\&quot;1\&quot;/><text x=\&quot;375\&quot; y=\&quot;130\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;Arial\&quot; font-size=\&quot;14\&quot; fill=\&quot;%23495057\&quot;>Room 2</text><rect x=\&quot;500\&quot; y=\&quot;50\&quot; width=\&quot;250\&quot; height=\&quot;150\&quot; fill=\&quot;none\&quot; stroke=\&quot;%23adb5bd\&quot; stroke-width=\&quot;1\&quot;/><text x=\&quot;625\&quot; y=\&quot;130\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;Arial\&quot; font-size=\&quot;14\&quot; fill=\&quot;%23495057\&quot;>Conference Room</text><rect x=\&quot;50\&quot; y=\&quot;250\&quot; width=\&quot;300\&quot; height=\&quot;200\&quot; fill=\&quot;none\&quot; stroke=\&quot;%23adb5bd\&quot; stroke-width=\&quot;1\&quot;/><text x=\&quot;200\&quot; y=\&quot;355\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;Arial\&quot; font-size=\&quot;14\&quot; fill=\&quot;%23495057\&quot;>Open Office</text><rect x=\&quot;400\&quot; y=\&quot;250\&quot; width=\&quot;150\&quot; height=\&quot;100\&quot; fill=\&quot;none\&quot; stroke=\&quot;%23adb5bd\&quot; stroke-width=\&quot;1\&quot;/><text x=\&quot;475\&quot; y=\&quot;305\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;Arial\&quot; font-size=\&quot;14\&quot; fill=\&quot;%23495057\&quot;>Kitchen</text><rect x=\&quot;400\&quot; y=\&quot;400\&quot; width=\&quot;150\&quot; height=\&quot;100\&quot; fill=\&quot;none\&quot; stroke=\&quot;%23adb5bd\&quot; stroke-width=\&quot;1\&quot;/><text x=\&quot;475\&quot; y=\&quot;455\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;Arial\&quot; font-size=\&quot;14\&quot; fill=\&quot;%23495057\&quot;>Storage</text><rect x=\&quot;600\&quot; y=\&quot;250\&quot; width=\&quot;150\&quot; height=\&quot;250\&quot; fill=\&quot;none\&quot; stroke=\&quot;%23adb5bd\&quot; stroke-width=\&quot;1\&quot;/><text x=\&quot;675\&quot; y=\&quot;380\&quot; text-anchor=\&quot;middle\&quot; font-family=\&quot;Arial\&quot; font-size=\&quot;14\&quot; fill=\&quot;%23495057\&quot;>Meeting Room</text></svg>&quot;);"><div class="circle-button" data-button-id="btn_1754690379908" draggable="true" style="left: 620px; top: 340px;" onclick="openModal('btn_1754690379908')">1</div></div>

    <div class="modal" id="mediaModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Room 1 Media</h3>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            
            <div class="file-upload-section">
                <button class="upload-btn" onclick="triggerFileUpload()">üìÅ Add Files</button>
                <input type="file" class="file-input" id="fileInput" multiple="" accept="image/*,video/*,.pdf,.doc,.docx,.txt" style="">
                <div style="font-size: 12px; color: #666;">Supports images, videos, and documents</div>
            </div>

            <div class="media-gallery" id="mediaGallery"><div class="media-item"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMjAwIDE1MCI+CiAgPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9InJlZCIvPgogIDx0ZXh0IHg9IjEwMCIgeT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LXNpemU9IjE2IiBmb250LWZhbWlseT0iQXJpYWwiPlRlc3QgSW1hZ2UgMTwvdGV4dD4KPC9zdmc+" class="media-preview" alt="test-image1.svg"><div class="media-name">test-image1.svg</div><button class="remove-media" onclick="removeMedia('media_1754690445475_ikrx8glg9')">√ó</button></div><div class="media-item"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMjAwIDE1MCI+CiAgPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9ImdyZWVuIi8+CiAgPHRleHQgeD0iMTAwIiB5PSI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtZmFtaWx5PSJBcmlhbCI+VGVzdCBJbWFnZSAyPC90ZXh0Pgo8L3N2Zz4=" class="media-preview" alt="test-image2.svg"><div class="media-name">test-image2.svg</div><button class="remove-media" onclick="removeMedia('media_1754690445479_jvrrxgg17')">√ó</button></div><div class="media-item"><div class="media-preview" style="background: #e9ecef; display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÑ</div><div class="media-name">test-document.txt</div><button class="remove-media" onclick="removeMedia('media_1754690445480_ps5o9gqmn')">√ó</button></div></div>
        </div>
    </div>

    <!-- Lightbox Carousel Modal -->
    <div class="lightbox" id="lightbox" style="display: none;">
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeLightbox()">√ó</button>
            <button class="lightbox-nav prev" id="lightboxPrev" onclick="navigateLightbox(-1)" style="display: block;">‚Äπ</button>
            <button class="lightbox-nav next" id="lightboxNext" onclick="navigateLightbox(1)" style="display: block;" disabled="">‚Ä∫</button>
            
            <div id="lightboxMediaContainer"><div class="lightbox-document">
                    <div class="lightbox-document-icon">üìÑ</div>
                    <div class="lightbox-document-name">test-document.txt</div>
                    <button class="lightbox-download-btn" onclick="downloadFile('data:text/plain;base64,VGhpcyBpcyBhIHRlc3QgZG9jdW1lbnQgZm9yIHRoZSBNYXAgQ3JlYXRvciBsaWdodGJveCBmdW5jdGlvbmFsaXR5IHRlc3RpbmcuCgpJdCBjb250YWlucyBzYW1wbGUgdGV4dCB0byB2ZXJpZnkgdGhhdCBkb2N1bWVudCBoYW5kbGluZyB3b3JrcyBwcm9wZXJseQppbiBib3RoIHRoZSBsaXZlIGFwcGxpY2F0aW9uIGFuZCBleHBvcnRlZCB2ZXJzaW9ucy4KCkZlYXR1cmVzIHRvIHRlc3Q6Ci0gRG9jdW1lbnQgcHJldmlldyBpbiBtZWRpYSBnYWxsZXJ5Ci0gTGlnaHRib3ggdmlldyBmb3IgZG9jdW1lbnRzICAKLSBEb3dubG9hZCBmdW5jdGlvbmFsaXR5Ci0gQ2Fyb3VzZWwgbmF2aWdhdGlvbiBiZXR3ZWVuIG1lZGlhIHR5cGVzCgpEYXRlOiAyMDI0LTEyLTE5', 'test-document.txt')">
                        üì• Download File
                    </button>
                </div></div>
            
            <div class="lightbox-info" id="lightboxInfo">3 of 3 - test-document.txt</div>
        </div>
    </div>

    <script>
        let circleButtons = [{"id":"btn_1754690379908","number":1,"percentageX":50,"percentageY":50,"media":[{"id":"media_1754690445475_ikrx8glg9","name":"test-image1.svg","type":"image/svg+xml","data":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMjAwIDE1MCI+CiAgPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9InJlZCIvPgogIDx0ZXh0IHg9IjEwMCIgeT0iODAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LXNpemU9IjE2IiBmb250LWZhbWlseT0iQXJpYWwiPlRlc3QgSW1hZ2UgMTwvdGV4dD4KPC9zdmc+","size":252},{"id":"media_1754690445479_jvrrxgg17","name":"test-image2.svg","type":"image/svg+xml","data":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiB2aWV3Qm94PSIwIDAgMjAwIDE1MCI+CiAgPHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIxNTAiIGZpbGw9ImdyZWVuIi8+CiAgPHRleHQgeD0iMTAwIiB5PSI4MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0id2hpdGUiIGZvbnQtc2l6ZT0iMTYiIGZvbnQtZmFtaWx5PSJBcmlhbCI+VGVzdCBJbWFnZSAyPC90ZXh0Pgo8L3N2Zz4=","size":254},{"id":"media_1754690445480_ps5o9gqmn","name":"test-document.txt","type":"text/plain","data":"data:text/plain;base64,VGhpcyBpcyBhIHRlc3QgZG9jdW1lbnQgZm9yIHRoZSBNYXAgQ3JlYXRvciBsaWdodGJveCBmdW5jdGlvbmFsaXR5IHRlc3RpbmcuCgpJdCBjb250YWlucyBzYW1wbGUgdGV4dCB0byB2ZXJpZnkgdGhhdCBkb2N1bWVudCBoYW5kbGluZyB3b3JrcyBwcm9wZXJseQppbiBib3RoIHRoZSBsaXZlIGFwcGxpY2F0aW9uIGFuZCBleHBvcnRlZCB2ZXJzaW9ucy4KCkZlYXR1cmVzIHRvIHRlc3Q6Ci0gRG9jdW1lbnQgcHJldmlldyBpbiBtZWRpYSBnYWxsZXJ5Ci0gTGlnaHRib3ggdmlldyBmb3IgZG9jdW1lbnRzICAKLSBEb3dubG9hZCBmdW5jdGlvbmFsaXR5Ci0gQ2Fyb3VzZWwgbmF2aWdhdGlvbiBiZXR3ZWVuIG1lZGlhIHR5cGVzCgpEYXRlOiAyMDI0LTEyLTE5","size":372}]}];
        let currentButtonId = null;
        let currentLightboxMedia = [];
        let currentLightboxIndex = 0;

        function getBackgroundImageBounds() {
            const mapContainer = document.getElementById('mapContainer');
            const containerRect = mapContainer.getBoundingClientRect();
            
            // Background image is an SVG with viewBox="0 0 800 600"
            const imageAspectRatio = 800 / 600; // 4:3 aspect ratio
            const containerAspectRatio = containerRect.width / containerRect.height;
            
            let imageWidth, imageHeight, imageLeft, imageTop;
            
            if (containerAspectRatio > imageAspectRatio) {
                // Container is wider than image - image will be constrained by height
                imageHeight = containerRect.height;
                imageWidth = imageHeight * imageAspectRatio;
                imageLeft = (containerRect.width - imageWidth) / 2;
                imageTop = 0;
            } else {
                // Container is taller than image - image will be constrained by width
                imageWidth = containerRect.width;
                imageHeight = imageWidth / imageAspectRatio;
                imageLeft = 0;
                imageTop = (containerRect.height - imageHeight) / 2;
            }
            
            return {
                left: imageLeft,
                top: imageTop,
                width: imageWidth,
                height: imageHeight,
                right: imageLeft + imageWidth,
                bottom: imageTop + imageHeight
            };
        }
        
        function percentageToPixel(percentageX, percentageY) {
            const bounds = getBackgroundImageBounds();
            const pixelX = bounds.left + (percentageX / 100) * bounds.width;
            const pixelY = bounds.top + (percentageY / 100) * bounds.height;
            
            return {
                x: pixelX,
                y: pixelY
            };
        }
        
        function updateButtonPosition(buttonElement, percentageX, percentageY) {
            const pixelPos = percentageToPixel(percentageX, percentageY);
            buttonElement.style.left = (pixelPos.x - 20) + 'px'; // Offset by half button width
            buttonElement.style.top = (pixelPos.y - 20) + 'px';  // Offset by half button height
        }
        
        function repositionAllButtons() {
            circleButtons.forEach(buttonData => {
                const button = document.querySelector('[data-button-id="' + buttonData.id + '"]');
                if (button) {
                    updateButtonPosition(button, buttonData.percentageX, buttonData.percentageY);
                }
            });
        }

        window.addEventListener('resize', function() {
            setTimeout(repositionAllButtons, 10);
        });

        function openModal(buttonId) {
            currentButtonId = buttonId;
            const buttonData = circleButtons.find(btn => btn.id === buttonId);
            
            document.getElementById('modalTitle').textContent = 'Room ' + buttonData.number + ' Media';
            displayMedia(buttonData.media);
            document.getElementById('mediaModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('mediaModal').style.display = 'none';
            currentButtonId = null;
        }

        function displayMedia(mediaItems) {
            const gallery = document.getElementById('mediaGallery');
            gallery.innerHTML = '';
            
            if (mediaItems.length === 0) {
                gallery.innerHTML = '<div class="empty-state">No media files were added to this room.</div>';
                return;
            }
            
            mediaItems.forEach((item, index) => {
                const mediaDiv = document.createElement('div');
                mediaDiv.className = 'media-item';
                
                let preview = '';
                if (item.type.startsWith('image/')) {
                    preview = '<img src="' + item.data + '" class="media-preview" alt="' + item.name + '">';
                } else if (item.type.startsWith('video/')) {
                    preview = '<video src="' + item.data + '" class="media-preview" controls></video>';
                } else {
                    preview = '<div class="media-preview" style="background: #e9ecef; display: flex; align-items: center; justify-content: center; font-size: 24px;">üìÑ</div>';
                }
                
                mediaDiv.innerHTML = preview + '<div class="media-name">' + item.name + '</div>';
                
                // Make media items clickable to open lightbox
                mediaDiv.onclick = function(e) {
                    openLightbox(index);
                };
                
                // For documents, also allow direct download on right-click
                if (!item.type.startsWith('image/') && !item.type.startsWith('video/')) {
                    mediaDiv.oncontextmenu = function(e) {
                        e.preventDefault();
                        downloadFile(item.data, item.name);
                    };
                }
                
                gallery.appendChild(mediaDiv);
            });
        }

        function openLightbox(mediaIndex) {
            const buttonData = circleButtons.find(btn => btn.id === currentButtonId);
            if (!buttonData || !buttonData.media || buttonData.media.length === 0) return;
            
            currentLightboxMedia = buttonData.media;
            currentLightboxIndex = mediaIndex;
            
            updateLightboxContent();
            document.getElementById('lightbox').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeLightbox() {
            document.getElementById('lightbox').style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore background scrolling
            
            // Pause any playing video
            const video = document.querySelector('#lightboxMediaContainer video');
            if (video) {
                video.pause();
            }
        }

        function navigateLightbox(direction) {
            const newIndex = currentLightboxIndex + direction;
            if (newIndex >= 0 && newIndex < currentLightboxMedia.length) {
                currentLightboxIndex = newIndex;
                updateLightboxContent();
            }
        }

        function updateLightboxContent() {
            const mediaContainer = document.getElementById('lightboxMediaContainer');
            const infoElement = document.getElementById('lightboxInfo');
            const prevBtn = document.getElementById('lightboxPrev');
            const nextBtn = document.getElementById('lightboxNext');
            
            if (currentLightboxMedia.length === 0) return;
            
            const currentMedia = currentLightboxMedia[currentLightboxIndex];
            
            // Clear previous content
            mediaContainer.innerHTML = '';
            
            // Update navigation button states
            prevBtn.disabled = currentLightboxIndex === 0;
            nextBtn.disabled = currentLightboxIndex === currentLightboxMedia.length - 1;
            
            // Hide navigation if only one item
            if (currentLightboxMedia.length === 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            } else {
                prevBtn.style.display = 'block';
                nextBtn.style.display = 'block';
            }
            
            // Update info
            infoElement.textContent = (currentLightboxIndex + 1) + ' of ' + currentLightboxMedia.length + ' - ' + currentMedia.name;
            
            // Display media based on type
            if (currentMedia.type.startsWith('image/')) {
                // Display image
                const img = document.createElement('img');
                img.src = currentMedia.data;
                img.className = 'lightbox-media';
                img.alt = currentMedia.name;
                mediaContainer.appendChild(img);
            } else if (currentMedia.type.startsWith('video/')) {
                // Display video
                const video = document.createElement('video');
                video.src = currentMedia.data;
                video.className = 'lightbox-media';
                video.controls = true;
                video.autoplay = false;
                mediaContainer.appendChild(video);
            } else {
                // Display document interface
                const docDiv = document.createElement('div');
                docDiv.className = 'lightbox-document';
                
                docDiv.innerHTML = '<div class="lightbox-document-icon">üìÑ</div>' + 
                    '<div class="lightbox-document-name">' + currentMedia.name + '</div>' +
                    '<button class="lightbox-download-btn" onclick="downloadFile(\'' + currentMedia.data + '\', \'' + currentMedia.name + '\')">üì• Download File</button>';
                
                mediaContainer.appendChild(docDiv);
            }
        }

        function downloadFile(dataUrl, filename) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const mediaModal = document.getElementById('mediaModal');
            if (e.target === mediaModal) {
                closeModal();
            }
            
            // Close lightbox when clicking outside
            const lightbox = document.getElementById('lightbox');
            if (e.target === lightbox) {
                closeLightbox();
            }
        });

        // Keyboard navigation for lightbox
        document.addEventListener('keydown', function(e) {
            const lightbox = document.getElementById('lightbox');
            if (lightbox.style.display === 'block') {
                switch(e.key) {
                    case 'Escape':
                        closeLightbox();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        navigateLightbox(-1);
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        navigateLightbox(1);
                        break;
                }
            }
        });
        
        // Initialize button positions when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(repositionAllButtons, 10);
        });</script>

</body></html>